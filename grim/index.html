
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../images/weather-lightning.svg">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.3">
    
    
      
        <title>GRIM - GRIM</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.5143246d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#757575">
        
      
    
    
    
      
    
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="grey" data-md-color-accent="blue">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#main-idea" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="GRIM" class="md-header__button md-logo" aria-label="GRIM" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 16a5 5 0 0 1-5-5 5 5 0 0 1 5-5c1-2.35 3.3-4 6-4 3.43 0 6.24 2.66 6.5 6.03L19 8a4 4 0 0 1 4 4 4 4 0 0 1-4 4h-1a1 1 0 0 1-1-1 1 1 0 0 1 1-1h1a2 2 0 0 0 2-2 2 2 0 0 0-2-2h-2V9a5 5 0 0 0-5-5C9.5 4 7.45 5.82 7.06 8.19 6.73 8.07 6.37 8 6 8a3 3 0 0 0-3 3 3 3 0 0 0 3 3h1a1 1 0 0 1 1 1 1 1 0 0 1-1 1H6m6-5h3l-2 4h2l-3.75 7 .75-5H9.5l2.5-6z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            GRIM
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              GRIM
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="GRIM" class="md-nav__button md-logo" aria-label="GRIM" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 16a5 5 0 0 1-5-5 5 5 0 0 1 5-5c1-2.35 3.3-4 6-4 3.43 0 6.24 2.66 6.5 6.03L19 8a4 4 0 0 1 4 4 4 4 0 0 1-4 4h-1a1 1 0 0 1-1-1 1 1 0 0 1 1-1h1a2 2 0 0 0 2-2 2 2 0 0 0-2-2h-2V9a5 5 0 0 0-5-5C9.5 4 7.45 5.82 7.06 8.19 6.73 8.07 6.37 8 6 8a3 3 0 0 0-3 3 3 3 0 0 0 3 3h1a1 1 0 0 1 1 1 1 1 0 0 1-1 1H6m6-5h3l-2 4h2l-3.75 7 .75-5H9.5l2.5-6z"/></svg>

    </a>
    GRIM
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../design/" class="md-nav__link">
        Design
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        GRIM
      </a>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="main-idea">Main Idea<a class="headerlink" href="#main-idea" title="Permanent link">&para;</a></h1>
<ul>
<li>Machine - Either bare metal or VM or VM on cloud provider</li>
<li>Machine can be running Ubuntu or Alpine</li>
<li>
<p>Machine needs KVM</p>
</li>
<li>
<p>The Machine runs the grim-agent binary, which manages generating Firecracker microVMs and isolating them with the jailer</p>
</li>
<li>Each Firecracker microVM runs the grim-uvm, which manages pulling the container images and starting the processes</li>
<li>
<p>grim-uvm does this via containerd, runc and cni</p>
</li>
<li>
<p>More than one Machine's are arranged into logical groups. No clustering, and they arent aware of each other, they are completely independent from one another.</p>
</li>
<li>Some other machine somewhere, is running the grim binary. This is the CLI and web UI for talking to the grim-agent on the Machine's. It allows humans to collate Machine's into logical groups.</li>
<li>
<p>The grim binary is where the central management happens. It decides which containers run on which Machines.</p>
</li>
<li>
<p>Humans can notify the web UI of new containers / deployments by providing it with a Task Definition file. This is similar to the one used on AWS Fargate. It denotes how much CPU/RAM to allocate, which group to assign to, and which images to use.</p>
</li>
</ul>
<h1 id="alternative">Alternative<a class="headerlink" href="#alternative" title="Permanent link">&para;</a></h1>
<ul>
<li>Use LXD for containerisation instead of full VMs. Less flexible because need Ubuntu+Snap. Means can run on cloud though because sometimes you cant use nested virtualisation.</li>
<li>Use puppet for controlling all config and app deployment config. This means its just one DSL to learn rather than K8s yaml, CI/CD yaml, Docker, bash etc.</li>
<li>Create BUBO server for CI/CD</li>
<li>Puppet shouldnt store what containers are running where, otherwise you need to have every app deployment be a change to the puppet repo which gets messy. Let LXD do that bit, and puppet figure it out. Maybe need fabric for glue.</li>
</ul>
<h1 id="other-alternative">Other alternative<a class="headerlink" href="#other-alternative" title="Permanent link">&para;</a></h1>
<p>Closer to what Heroku, Deta and Fly.io are doing. Provide a CLI/API which you give a basic task definition with a dockerfile, and we run it. Apps, load balancers, storage, DBs. </p>
<p>Maybe a combination of both approaches. We use puppet etc. to manage the actual infra, which is quite basic like storage is just ZFS with block volumes exposed over NFS. Then we just connect them up using a nice and simple CLI/API interface.</p>
<p>Maybe running containers could just be with containerd. Would need to be able to pass env vars and mount storage devices.</p>
<p>Could use this: https://github.com/firecracker-microvm/firecracker-containerd on the host. Just need to coordinate getting the images etc. to this daemon</p>
<p>DBs would run in different ways:</p>
<ul>
<li>Inside microVMs</li>
<li>1 DB for 1 host</li>
</ul>
<p>Then different types:</p>
<ul>
<li>Sqlite standalone</li>
<li>Sqlite with Litestream</li>
<li>Postgresql standalone</li>
<li>Postgresql with HA</li>
</ul>
<p>Wireguard for inter-host traffic where required for e.g. DB replication. Management layer done with SSH. SSHFP records pulled from the host via puppet and updated on some other system so that DNS can be updated. Then when management box connects to hosts it can use DNS for host validation.</p>
<p>Install fluent bit and maybe other monitoring plugins within the microVM.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../design/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Design" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Design
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.8397ff9e.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f89c2efe.min.js"></script>
      
    
  </body>
</html>